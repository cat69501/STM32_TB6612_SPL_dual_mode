# STM32F103C8T6 IO分配总表（C8T6最小系统板适配版）

## 项目概述
本项目使用STM32F103C8T6微控制器，实现TB6612双路电机驱动、编码器反馈、PWM遥控器控制和舵机控制功能。
本版本已适配C8T6最小系统板的有效IO限制。

## C8T6最小系统板可用IO
A0-A12, A15, B0-B1, B3-B15

## IO分配总表

### 定时器资源分配

| 定时器 | 功能 | 通道使用 | 引脚 |
|--------|------|----------|------|
| TIM1 | 电机A PWM输出 | CH1 | PA8 |
| TIM1 | 电机B PWM输出 | CH4 | PA11 |
| TIM2 | 编码器B接口 | CH1/CH2 | PA0/PA1 |
| TIM3 | 编码器A接口 | CH1/CH2 | PA6/PA7 |
| TIM4 | PWM输入捕获 | CH1/CH2 | PB6/PB7 (遥控器输入) |
| TIM5 | 舵机PWM输出 | CH4 | PA3 |

### 引脚功能详细分配

| 引脚 | 功能 | 方向 | 说明 |
|------|------|------|------|
| **PORTA** | | | |
| PA0 | TIM2_CH1 | 输入 | 编码器B A相输入 |
| PA1 | TIM2_CH2 | 输入 | 编码器B B相输入 |
| PA2 | ADC1_IN2 | 输入 | 电压检测（1/11分压） |
| PA3 | TIM5_CH4 | 输出 | 舵机PWM控制信号 |
| PA6 | TIM3_CH1 | 输入 | 编码器A A相输入 |
| PA7 | TIM3_CH2 | 输入 | 编码器A B相输入 |
| PA8 | TIM1_CH1 | 输出 | 电机A PWM速度控制 |
| PA9 | USART1_TX | 输出 | 调试串口发送 |
| PA10 | USART1_RX | 输入 | 调试串口接收 |
| PA11 | TIM1_CH4 | 输出 | 电机B PWM速度控制 |
| **PORTB** | | | |
| PB3 | GPIO | 输出 | 电机A方向控制AIN1 |
| PB4 | GPIO | 输出 | 电机A方向控制AIN2 |
| PB5 | GPIO | 输出 | 电机B方向控制BIN1 |
| PB6 | TIM4_CH1 | 输入 | PWM输入通道1（电机控制） |
| PB7 | TIM4_CH2 | 输入 | PWM输入通道2（舵机控制） |
| PB8 | GPIO | 输出 | 电机B方向控制BIN2 |

### 功能模块说明

#### 1. 电机控制
- 使用TIM1的CH1和CH4产生PWM信号
- PB3,PB4,PB5,PB8控制电机方向
- PWM频率：10kHz

#### 2. 编码器接口
- 编码器A：使用TIM3编码器模式（PA6/PA7）
- 编码器B：使用TIM2编码器模式（PA0/PA1）
- 支持正反转自动计数

#### 3. PWM遥控器输入
- 使用TIM4的输入捕获功能（PB6/PB7）
- 捕获频率：50Hz
- 脉宽范围：1000-2000μs

#### 4. 舵机控制
- 使用TIM5的CH4产生50Hz PWM（PA3）
- 脉宽范围：500-2500μs

#### 5. 系统监测
- ADC1_IN2监测电源电压（PA2）
- USART1用于调试输出（PA9/PA10）

## 注意事项

1. **C8T6适配**：所有功能已适配C8T6最小系统板的有效IO限制
2. **定时器冲突处理**：已完全解决定时器冲突，现在每个功能使用独立的定时器资源
3. **兼容性**：专为STM32F103C8T6设计，不再兼容RCT6

## 移植变更记录

### V2.2 (最终修复版)  
- 电机B PWM：PA15→PA11，使用TIM1_CH4  
- 完全解决所有定时器资源冲突
- 双电机现在都使用TIM1的不同通道，配置统一
- 最优化的资源分配方案

### V2.1 (定时器冲突修复版)
- 电机B PWM：PA15(TIM2_CH1_ETR)→PB9(TIM4_CH4)
- 解决TIM2定时器资源冲突问题
- TIM2现在专用于编码器B输入
- TIM4同时处理PWM输入捕获(CH1/CH2)和电机B PWM输出(CH4)

### V2.0 (C8T6适配版)
- 电机B PWM：PA11→PA15 (TIM1_CH4→TIM2_CH1_ETR)
- 电机A方向：PB12/PB13→PB3/PB4
- 电机B方向：PB14/PB15→PB5/PB8
- PWM输入保持：PB6/PB7 (解决引脚冲突)
- 解决了原设计中的C8T6 IO限制问题